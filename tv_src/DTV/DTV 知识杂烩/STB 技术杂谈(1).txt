 最近看一些美国大片，发现其实老外并不比我们聪明。但是他们却经常能取得巨大的成就，想了好久，发现一个很重要的主观原因――耐心！因为他们有耐心，持之以恒，所以一步一个脚印的迈向成功。
       一年前，我在找工作的时候，也曾经热情澎湃，想着要坚持写一个很好的博客。但是，找到工作后，比较忙，再因为种种借口，博客已经停了一年没更新了。这一年中，主要做的是数码相框、电视棒、机顶盒（Demode部分）、Portable TV（DVB-T）整机方案的东西。很有必要写出来，见证自己的历程，同时也与网友一同探讨学习。
         OK,废话说完了，直接进入正题――先看一个机顶盒方案最基础的部分：
 
传输流
解复用器
MPEG-2
解码器
嵌入式
CPU
接口电路
调谐器
QPSK
解调器
视频滤波网络
音频
D/A
FLASH
ROM
SDRAM
操作面板
CA卡
电源
 
 

事实上我想讲的都focus在蓝色框跟红色框中，因为其他的外围电路，几乎是其他嵌入式产品都有的，没什么太多可以讲。蓝色框部分包含 tuner（调谐器）跟 demodulator（解调器），也就是我们公司现在主推的部分（其实这个放在一起只是因为他们都算前端电路，其实是两个不一样的IC，当然目前也有把tuner包进 demodulator 的，我们公司就有！但是这样的方案一般用在手机电视，或者PND+DTV之类的）。红色部分是主控IC，内置的decoder。这个是目前比较主流的方案，老式的方案有把decoder 拿到主控IC外面的，然后给了它另外一个名字DSP。最新的主控IC,有的已经把 demodulator 也包到里面去了，这样集成度越高，成本会越低，当然技术要求也是越高的。因为高频的东西，走线等原因，都会对performance有很多的影响。
         对于上图中的外围电路，我们还是简单概括一下：EEPROM，一般用来读取存放频道参数等信息。FLASH ROM，用于存放程序。SDRAM，这个就不用说了吧。。。操作面板，指IR或键盘按钮；智能卡座，这个不是一定要有的。
         下面，重点讲下工作过程：RF信豪输入后，先由调制器进行低噪声放大，滤波和变频，将其转换成两路相位相差90°的中频信号I和Q，I、Q 信号经过解调器中的双A\D 转换器转换成数字信号后，再和QAM解调器进行解调、交织、里德-索罗门解码等一系列处理，成为符合MPEG-2标准的传输码流。对于加密节目，则通过读取放置在机器中的CA卡中的用户权限信息，与TS码流中提取的ECM 的节目授权信息进行比较，对于符合条件的ECM信息即可解出其中的控制字，然后再用此控制字对传输流进行解扰。对于MCPC 方式的传输码流，要先经过传输流解复用器，将其分解成单个节目流，然后再由节目流复用器分解为音、视频和专用数据基本码流。音、视频基本码流分别送到音、视频解码器，经解码后还原成原始的音、视频数据。
         讲完了总的结构及工作流程，下面针对分模块详细叙述：
调谐器（Tuner）
       Tuner 针对不同的使用领域，有很多的分类方式，我们这里只讲用于DVB 的。同时，我们把Tuner 分铁盒调谐器（Can Tuner）跟硅Tuner（silicon Tuner）。
Can Tuner：从外观上看，他被一个铁盒包起来，体积比较大。其内部结构，使用传统的模拟技术，拆开可以看到很多绕线，线圈之类的东西。经验证明，此类高频头，最大的好处是收讯效果好，坏处是成本贵，占用空间大。所以Can Tuner，目前主要使用在STB 上，或者一体机上。
       Can Tuner 基本工作原理: 电路最简单的调谐器是单转换中频输出调谐器。其基本组成包括混频器、振荡器、锁相环(MOPLL)和高频放大器等。高频放大器具有自动增益控制（AGC）功能，跟踪滤波器是一个中心频率可调的带通滤波器。中频滤波器是一个具有特殊传输特性的带通滤波器，一般为声表面波滤波器(SAWF)。单转换中频输出调谐器电路架构如图一所示：
 
 
 
射频电视信号进入调谐器的高频放大器进行放大，其增益由AGC电路自动控制，再由跟踪滤波器将镜像信号去除，利用混频器和本地振荡器混出中频信号，最后经由中频滤波器虑除杂波、选择出想要的频道并进一步调整通带特性，完成调谐器的功能。
       Can Tuner市场信息：去年刚入行，遇到金融危机，干了一年没加薪，真郁闷，小小抱怨一下。不过收获是有的，在深圳这个地方，做DTV相关电子产品的公司实在是太多了，整个跟着老大们在外面摸爬滚打，也了解了一些资讯，不过也不好细谈，只能简单讲讲：目前卖得比较好的主要是LG、英飞凌（Infineon）跟飞利浦（NXP），这其中有技术问题，有价格问题，有统筹问题，有服务问题。另一方面，天下人都知道中国的山寨业是多么NB，很都主流的Can Tuner，都已经 国内几个大厂仿造了，而且性能也做得不错，佩服！
       Silicon Tuner：采用先进的数字设计技术和硅半导体工艺，把原来铁盒调谐器中的大部分分立器件都集成到一颗硅芯片中，这就是硅调谐器。
       Silicon Tuner杂谈：Silicon Tuner 的发展，是特别迅速的。在网上搜了一下，发现08年以前的文章，还在说 Silicon Tuner 的好处是体积小。但是技术不完善：功耗大（其实现在功耗已经做到非常小）、价格贵（现在的价格杀到见骨，比Can Tuner 还便宜）、感度差（现在的感度其实已经差不多了，特别是最新的硅tuner引进了零中频的感念后，各方面综合性能提高很多。）另外，某些Silicon tuner 的厂商，已经把自己的die卖给其他的做demodulator 的商家，然后把 tuner 跟demodulator做成一颗，以降低成本。同时，在 STB 领域，也开始使用 Silicon Tuner 来做。只是大部分会像Can Tuner 那样，盖一个小铁盒，效果还不错。常见硅调谐器供应商有：Maxlinear、英飞凌公司（Infineon）、美信公司（Maxim）、瑞科信公司(Xceive)、恩智浦公司（NXP）、飞思卡尔（Freescale）、三星电子（Samsung）、LG 等
今天本来想写一篇demodulator 的文章，发现很多资料不知道放哪了...等公司买了新电脑一定要好好归类整理一下！先写点轻松点的，谈谈测试标准。
目前，DVB-T 主要还是用在欧洲那边的国家（深圳这边722 频点也能收到4 个节目），所以欧洲那边很多国家都有制定一些对DVB-T 的产品要求，主要常见的有：
 
欧洲E-book测试项目

 
 
英国DTG D-Book测试项目

 
 
北欧Nordig 测试项目

 
目前我们的大部分客户，都是以Nordig 为测试标准。Nordig 标准测试主要包括：
Sensitivity
C/N,（Wanted level =-50dBm,64QAM）
ACI,analog（Wanted Channel 666,level=-65dBm）
ACI(Digital）+A16（Wanted Channel 666,level=-65dBm）
C/I  LEVEL=-50dBm,INTERFERER FREQ=2.75MHz,SIGAL FREQ=0MHz,Wanted Channel 666MHz,ATV
Fandig（LEVEL=-50dBm）
可以参考附件这个样板
	
文件:	TEST.rar
大小:	8KB
下载:	下载
另外也可以参考这个完整的nordig标准说明。
	
文件:	NorDig-Unified_ver_2.1.pdf
大小:	1678KB
下载:	下载
 
诚如jk.xie 兄弟所述，其实nordig 的标准是比较容易过的。实际上目前大多少客户都用D-book，D-book 的测试麻烦很多，要求也高很多，特别是在N+3,N+4 的地方。前年做STB的方案，客户要求都比较简单，大部分只关心64QAM,7/8,1/32能不能到-80dB 的灵敏度。后来很多实地测试发现，灵敏度并没有那么特别的重要，要配合ACI等各方面的指标都比较平坦，稳定，才是一个好的前端。否则经常出现实地测试出现各种奇怪现象的问题。
关于DVB-T 的测试，补充两点最近一些了解到的消息：
1、伊朗客户会使用 CodeRate 2/3，Level -80dB 的条件下去测试 C/N，而且要求很高，大部分之前稳定出货伊朗的STB，都被此规定拦截下来了，有意思，没搞明白为什么会有这样的要求。
2、澳大利亚那边，因为电台覆盖率的重叠，导致很多地方会重复收到一样的节目。所以他们规定信号强的频点，保留节目的原名。信号弱的，要自动改名排后面，还蛮搞笑的：）


STB结合所谓3C功能的电子产品，不再受到Wintel(Microsoft Windows and Intel)架构的主宰，所以，在实时操作系统（Real Time OS）、中介软件（Middleware）及应用软件等方面便呈现百家争鸣的竞争态势，但也是因为软件平台过于多元，形成数字STB推向零售市场的障碍，如何整合或提升兼容性是仍待克服的一点。以下图表中列出各项软件主要产品或供应厂商：

 

其中较值得一提的是CA的软件，CA 模块提供收费、锁码与加密等功能，以及，电子节目表（EPG；Electronic Programming Guide），可浏览各频道节目、提供各节目信息、更可以设定观赏节目时间，是提供更具亲合力交互式操作接口的应用软件。

◆ CA（Conditional Access）

STB中有CA便可以控制哪一级的用户用哪一种service，也可以防止别人盗用未经授权的讯号。STB 厂商必须与电视系统台用同一家CA 的技术，才能够被授权解开安全码，还原该台的讯号。换句话说，根据不同的CA 所设计的数字系统会有不同的STB。而不同的STB 专门服务不同的电视台。像我国东森用的CA是Viaccess 厂的，而和信使用的是NDS厂的CA，要换系统台就要换盒子。

◆ EPG（Electronic Program Guide）

至于这些SI(Service Information)送出来之后，观众可以用EPG在电视上看到。简而言之，EPG 是一种图形化的使用者接口也是一种应用软件，系统经营者可以利用它在头端编辑节目与服务表，而使用者在电视上也可以藉由简易的操作来找寻自己想看的节目。一般来说STB制造者都会把解SI 的机制装在盒子里，所以用户买了STB 之后就可以在电视上看到EPG。

◆ 中介软件(Middlew are)

像Windows一样，但不至于到OS那样复杂的程度。不同的STB 其底层的软件、硬件、沟通信道等架构都不同，就像计算机的硬设备可以是技嘉、华硕等不同厂牌，但是计算机灌了windows 之后，就可以使用各种应用程序。而MHP就是像windows 一样的东西，不但可以让EPG 看起来一致，还可以有花俏、多样化的信息服务、如与电视内容同步的分数卡、互动电玩、家庭银行等，还可以连接TV、PC 及其它诸如DVD Player 等产品。等于是打开全新优质的互动应用市场之门，类似portal入口网站的概念。

◆ 及时操作系统(RTOS)

RTOS为STB软件重要之一环，其如同个人计算机(PC)之Windows 98、NT workstation、UNIX和MacOS等操作系统(Operation System；OS)一般，因应系统各应用程序之及时处理与设备资源管理。

目前已有多家业者推出STB之RTOS产品，主要厂商如表一所示。其中以购并ISI的WinRiver在市场上占有较大优势；至于来自信息软件界巨子的微软，由于跨足该领域较晚，因此以财务优势透过多起购并和投资案，希望将其Windows CE操作系统安装入这些业者所掌握的STB中，但是微软的系统包裹过多的附加功能，因而加重系统操作与成本负担，并一再延后开发进度，反而促使以低价、轻便为诉求的Linux系统有逐渐抬头的趋势，已有部分业者转而投向升阳(Sun Microsystem)的Java OS。

软件开发者
产品名称
WinRiver
Vxworks、PSOS
Microsoft
WinCE
Sun Microsystem
Java OS
Linux
Lino
Microware
Microware's David OS9
PowerTV
PowerTV OS
图表--STB之RTOS业者与产品一览


